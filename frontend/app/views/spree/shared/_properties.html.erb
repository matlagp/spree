<% cache base_cache_key + [property.name, params[property.name], filtering_params_cache_key, @taxon&.id] do %>
  <% selected_properties = params[property.name]&.split(',')&.map(&:to_i) || [] %>
  <% property.uniq_values.each do |property_value| %>
    <% property_value_param = (selected_properties.include?(property_value) ? selected_properties - [property_value] : selected_properties + [property_value]).join(',') %>
    <%= link_to permitted_params.merge(property.name => property_value_param, menu_open: 1), data: { params: permitted_params.merge(property.name => property_value_param, menu_open: 1), id: property_value, filter_name: property.name, multiselect: true } do %>
      <div class="d-inline-block text-uppercase py-1 px-2 m-1 plp-overlay-card-item <%= 'plp-overlay-card-item--selected' if selected_properties.include?(property_value) %>">
        <%= property_value %>
      </div>
    <% end %>
  <% end %>
<% end %>
